<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>To-Do with Calendar & Progress</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: url('fdc.jpg') no-repeat center center/cover; /* Background */
    display: flex;
    justify-content: space-between; /* Space out left, center, right */
    align-items: flex-start;
    padding: 20px;
    min-height: 100vh;
    gap: 30px;
  }

  /* Left Side Image */
  #sideimg {
    width: 300px;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    flex-shrink: 0;
  }
  #sideimg img {
    width: 100%;
    height: auto;
    display: block;
  }

  /* Center Content */
  #mainContent {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
  }

  #todoBox {
    width: 350px;
    background: rgba(255,255,255,0.95);
    border-radius: 20px;
    box-shadow: 0 15px 35px rgba(0,0,0,0.2);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  .header {
    background: #4cafef;
    color: white;
    text-align: center;
    padding: 15px;
    font-size: 20px;
    font-weight: bold;
  }
  ul {
    list-style: none;
    padding: 15px;
    margin: 0;
    flex-grow: 1;
    overflow-y: auto;
  }
  li {
    background: #e8f4ff;
    padding: 10px 12px;
    margin-bottom: 10px;
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }
  li small {
    font-size: 12px;
    color: #555;
    margin-top: 4px;
  }
  .delete {
    color: red;
    cursor: pointer;
    font-weight: bold;
    align-self: flex-end;
    margin-top: 5px;
  }
  .inputArea {
    display: flex;
    padding: 15px;
    border-top: 1px solid #ddd;
    background: #f7f9fc;
  }
  input {
    flex: 1;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 10px;
    outline: none;
  }
  button.addBtn {
    padding: 10px 15px;
    border: none;
    background: #4cafef;
    color: white;
    border-radius: 10px;
    cursor: pointer;
    margin-left: 8px;
    font-weight: bold;
  }
  button.addBtn:hover {
    background: #ba23d8;
  }

  #calendar {
    width: 350px;
  }
  .day-marked {
    background: #4caf50 !important;
    color: white !important;
    border-radius: 50%;
  }

  /* Right Side Chart */
  #chartContainer {
    width: 350px;
    background: rgba(255,255,255,0.95);
    border-radius: 20px;
    box-shadow: 0 15px 35px rgba(0,0,0,0.2);
    padding: 20px;
    flex-shrink: 0;
  }
</style>
</head>
<body>

  <!-- Left Side Image -->
  <div id="sideimg">
    <img src="moto.jpg" alt="Moto">
  </div>

  <!-- Center: To-Do and Calendar -->
  <div id="mainContent">
    <div id="todoBox">
      <div class="header">üìù My Notes</div>
      <ul id="taskList"></ul>
      <div class="inputArea">
        <input type="text" id="taskInput" placeholder="Type a note...">
        <button class="addBtn" onclick="addTask()">Add</button>
      </div>
    </div>
    <div id="calendar"></div>
  </div>

  <!-- Right Side Progress Chart -->
  <div id="chartContainer">
    <canvas id="progressChart"></canvas>
  </div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const taskInput = document.getElementById("taskInput");
  const taskList = document.getElementById("taskList");

  function getLocalDateString(date = new Date()) {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
  }

  document.addEventListener("DOMContentLoaded", () => {
    loadTasks();
    renderCalendar();
    updateChart();
  });

  function loadTasks() {
    const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
    tasks.forEach(task => addTaskToDOM(task.text, task.date));
  }

  function addTask() {
    const text = taskInput.value.trim();
    if (!text) return;

    const today = getLocalDateString();
    addTaskToDOM(text, today);
    saveTask(text, today);
    taskInput.value = "";

    markStreak(today);
    renderCalendar();
    updateChart();
  }

  function addTaskToDOM(text, date) {
    const li = document.createElement("li");
    li.setAttribute("data-date", date);
    li.innerHTML = `
      <span class="task-text">${text}</span>
      <small>${date}</small>
      <span class="delete" onclick="deleteTask(this)">‚úñ</span>
    `;
    taskList.appendChild(li);
    taskList.scrollTop = taskList.scrollHeight;
  }

  function saveTask(text, date) {
    const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
    tasks.push({ text, date });
    localStorage.setItem("tasks", JSON.stringify(tasks));
  }

  function deleteTask(element) {
    const li = element.parentElement;
    const taskText = li.querySelector(".task-text").textContent;
    const taskDate = li.getAttribute("data-date");
    li.remove();

    let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
    tasks = tasks.filter(t => !(t.text === taskText && t.date === taskDate));
    localStorage.setItem("tasks", JSON.stringify(tasks));

    let streaks = JSON.parse(localStorage.getItem("streaks")) || [];
    streaks = streaks.filter(d => tasks.some(t => t.date === d));
    localStorage.setItem("streaks", JSON.stringify(streaks));

    renderCalendar();
    updateChart();
  }

  function markStreak(date) {
    let streaks = JSON.parse(localStorage.getItem("streaks")) || [];
    if (!streaks.includes(date)) streaks.push(date);
    localStorage.setItem("streaks", JSON.stringify(streaks));
  }

  function renderCalendar() {
    const streaks = JSON.parse(localStorage.getItem("streaks")) || [];
    flatpickr("#calendar", {
      inline: true,
      onDayCreate: (dObj, dStr, fp, dayElem) => {
        const dateStr = getLocalDateString(dayElem.dateObj);
        if (streaks.includes(dateStr)) dayElem.classList.add("day-marked");
      }
    });
  }

  function updateChart() {
    const streaks = JSON.parse(localStorage.getItem("streaks")) || [];
    const today = new Date();
    const daysInMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();

    const active = streaks.filter(d => {
      const [year, month] = d.split("-");
      return Number(year) === today.getFullYear() && Number(month) === (today.getMonth() + 1);
    }).length;

    const inactive = daysInMonth - active;

    const data = {
      labels: ['Active Days', 'Inactive Days'],
      datasets: [{
        data: [active, inactive],
        backgroundColor: ['#2196f3', '#ff9800'],
        borderColor: '#fff',
        borderWidth: 2
      }]
    };

    const config = {
      type: 'pie',
      data: data,
      options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
    };

    if (window.progressChart) window.progressChart.destroy();
    const ctx = document.getElementById('progressChart').getContext('2d');
    window.progressChart = new Chart(ctx, config);
  }
</script>
</body>
</html>
